generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  ADMIN
}

enum StaffRole {
  OWNER
  MANAGER
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  BANNED
  DELETED
}

enum PitchStatus {
  UNVERIFIED
  APPROVED
  REJECTED
  LIVE
  MAINTENANCE
  SUSPENDED
  DELETED
}

enum GroundStatus {
  ACTIVE
  MAINTENANCE
  INACTIVE
}

enum GroundPolicy {
  STRICT
  MODERATE
  LENIENT
}

enum GroundSport {
  FOOTBALL
  PADEL
  TENNIS
  BASKETBALL
  VOLLEYBALL
}

enum GroundSize {
  FIVE_A_SIDE
  SEVEN_A_SIDE
  ELEVEN_A_SIDE
  DEFAULT
}

enum GroundSurface {
  NATURAL_GRASS
  ARTIFICIAL_TURF
  HARD_WOOD
  OTHER
}

enum AmenityType {
  LIGHTING
  SEATING
  LOCKER_ROOMS
  SHOWERS
  TOILETS
  PARKING
  AIR_CONDITIONED
  HEATING
  SOUND_SYSTEM
  WATER_FOUNTAIN
  WIFI
  BALL_INCLUDED
  EQUIPMENT_RENTAL
  FIRST_AID
  REFEREE_SERVICE
  CAFETERIA
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  WALLET
}

enum Country {
  EG
  SA
  AE
}

enum Language {
  EN
  AR
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  createdAt DateTime @default(now())
  expiresAt DateTime
  revokedAt DateTime?

  ipAddress String?
  userAgent String?

  @@index([userId])
}

model User {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  phone     String   @unique
  password  String
  language  Language @default(EN)

  tokens RefreshToken[]
  isVerified Boolean @default(false)
  status UserStatus @default(ACTIVE)
  role   UserRole   @default(USER)

  pitches Staff[]

  deletedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([phone, status])
}

model Pitch {
  id            String  @id @default(cuid())
  name        String
  description String
  taxId         String?

  street         String
  area           String
  city           String
  country        Country
  latitude       Float
  longitude      Float
  googleMapsLink String
  amenityList    AmenityType[]

  status PitchStatus @default(UNVERIFIED)

  images     String[]
  coverImage String?

  layout           Json
  groundCount      Int           @default(0)
  availableSports  GroundSport[]
  availableSizes   GroundSize[]
  hasCombinations  Boolean       @default(false)
  minimumPrice     Int
  maximumPrice     Int
  operationalHours Int[]

  staff     Staff[]
  amenities Amenity[]
  grounds   Ground[]

  rejectionReason String?
  approvedAt      DateTime?
  verifiedBy      String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([country, city, status])
  @@index([longitude, latitude])
}

model Ground {
  id      String @id @default(cuid())
  pitchId String

  name        String
  description String?
  images        String[]
  sport         GroundSport
  surface       GroundSurface
  size          GroundSize

  status GroundStatus

  policy         GroundPolicy    @default(STRICT)
  paymentMethods PaymentMethod[]
  depositFee     Int?
  basePrice      Int
  peakPrice      Int?
  discountPrice  Int?

  operatingHours Int[]
  peakHours      Int[]
  discountHours  Int[]

  pitch Pitch @relation(fields: [pitchId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Staff {
  userId      String
  pitchId     String
  permissions Json
  role        StaffRole

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  pitch Pitch @relation(fields: [pitchId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([userId, pitchId])
}

model Amenity {
  pitchId     String
  order       Int
  name        AmenityType
  description String?
  isPaid      Boolean     @default(false)
  price       Int?

  pitch Pitch @relation(fields: [pitchId], references: [id], onDelete: Cascade)

  @@id([pitchId, order])
}
